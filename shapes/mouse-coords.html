<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>LibCanvas :: moving layers</title>
		<link href="/files/styles.css" rel="stylesheet" />
		<script src="/files/js/atom.js"></script>
		<script src="/files/js/libcanvas.js"></script>
	</head>
	<body>
		<canvas></canvas>
		<p><a href="/">Return to index</a></p>
		<script>
(function (buildings) {
	LibCanvas.extract();

	var app = new LibCanvas.App('canvas', {
		width : 1000,
		height: 500,
		mouse : true
	});

	var Element = atom.Class({
		Extends: LibCanvas.Scene.Element,

		Implements: Clickable,

		renderTo: function (ctx) {
			var shape = this.options.shape.clone();
			shape.from.move([0.5, 0.5]);
			shape.to.move([-0.5, -0.5]);
			ctx.fill( this.options.shape, this.hover ? '#100' : '#010' );
			ctx.stroke( shape, this.hover ? 'red' : 'green' );
			ctx.text({
				color: 'white',
				text : this.options.index,
				to   : shape,
				padding: 4
			});
		}
	});

	var scene = app.createScene({ intersection: 'manual' });

	scene.libcanvas.mouse.debug(true);

	scene.libcanvas.size( 4200, 2100 );
	var ctx = scene.libcanvas.ctx;
	ctx.fillAll( ctx.createGradient( ctx.rectangle, {
		'0.0': '#444',
		'0.2': '#222',
		'0.4': '#444',
		'0.6': '#222',
		'0.8': '#444',
		'1.0': '#222'
	}));
	
	buildings = buildings.map(function (rect, i) {
		return new Element( scene, {
			shape: Rectangle(rect),
			index: i,
			zIndex: i
		})
		.clickable()
		.addEvent( 'statusChanged', function () {
			this.redraw();
		});
	});

	var drag  = null;

	var stopDrag = function () {
		if (drag) {
			scene.resources.mouse.start();
			scene.addElementsShift(drag);
			scene.start();
		}
		drag = null;
	};

	app.libcanvas.mouse.addEvent({
		'down': function () {
			scene.resources.mouse.stop();
			scene.stop();
			drag = new Point(0, 0);
		},
		'up'  : stopDrag,
		'out' : stopDrag,
		'move': function (e) {
			if (!drag) return;
			drag.move( e.deltaOffset );
			scene.addShift( e.deltaOffset );
		}
	});
}([
	[  20,   20, 100,  50],
	[  20,   80, 100,  50],
	[  70,  140, 100,  50],
	[  70,  200, 100,  50],
	[  20,  140,  40, 100],
	[ 220,  240, 100, 100],
	[ 220,  120,  40, 100],
	[ 320,   20, 100,  50],
	[ 320,   80, 100,  50],
	[ 370,  140, 100,  50],
	[ 370,  200, 100,  50],
	[ 320,  140,  40, 100],
	[ 520,  240, 100, 100],
	[ 520,  120,  40, 100],
	[ 630,  240,  40, 100],
	[  20,  320, 100,  50],
	[  20,  380, 100,  50],
	[  70,  440, 100,  50],
	[  70,  500, 100,  50],
	[  20,  440,  40, 100],
	[ 220,  540, 100, 100],
	[ 220,  420,  40, 100],
	[ 320,  320, 100,  50],
	[ 320,  380, 100,  50],
	[ 370,  440, 100,  50],
	[ 370,  500, 100,  50],
	[ 320,  440,  40, 100],
	[ 520,  540, 100, 100],
	[ 520,  420,  40, 100],
	[ 630,  540,  40, 100],
	[ 720,   20, 100,  50],
	[ 720,   80, 100,  50],
	[ 770,  140, 100,  50],
	[ 770,  200, 100,  50],
	[ 720,  140,  40, 100],
	[ 920,  240, 100, 100],
	[ 920,  120,  40, 100],
	[ 720,  320, 100,  50],
	[ 720,  380, 100,  50],
	[ 770,  440, 100,  50],
	[ 770,  500, 100,  50],
	[ 720,  440,  40, 100],
	[ 920,  540, 100, 100],
	[ 920,  420,  40, 100],
	[  20,  620, 100,  50],
	[  20,  680, 100,  50],
	[  70,  740, 100,  50],
	[  70,  800, 100,  50],
	[  20,  740,  40, 100],
	[ 220,  840, 100, 100],
	[ 220,  720,  40, 100],
	[ 320,  720, 100,  50],
	[ 320,  780, 100,  50],
	[ 370,  840, 100,  50],
	[ 370,  900, 100,  50],
	[ 320,  840,  40, 100],
	[ 520,  940, 100, 100],
	[ 520,  820,  40, 100],
	[ 630,  940,  40, 100],
	[ 720,  720, 100,  50],
	[ 720,  780, 100,  50],
	[ 770,  840, 100,  50],
	[ 770,  900, 100,  50],
	[ 720,  840,  40, 100],
	[ 920,  940, 100, 100],
	[ 920,  820,  40, 100],
	[1020,   20, 100,  50],
	[1020,   80, 100,  50],
	[1070,  140, 100,  50],
	[1070,  200, 100,  50],
	[1020,  140,  40, 100],
	[1220,  240, 100, 100],
	[1220,  120,  40, 100],
	[1320,   20, 100,  50],
	[1320,   80, 100,  50],
	[1370,  140, 100,  50],
	[1370,  200, 100,  50],
	[1320,  140,  40, 100],
	[1520,  240, 100, 100],
	[1520,  120,  40, 100],
	[1630,  240,  40, 100],
	[1020,  320, 100,  50],
	[1020,  380, 100,  50],
	[1070,  440, 100,  50],
	[1070,  500, 100,  50],
	[1020,  440,  40, 100],
	[1220,  540, 100, 100],
	[1220,  420,  40, 100],
	[1320,  320, 100,  50],
	[1320,  380, 100,  50],
	[1370,  440, 100,  50],
	[1370,  500, 100,  50],
	[1320,  440,  40, 100],
	[1520,  540, 100, 100],
	[1520,  420,  40, 100],
	[1630,  540,  40, 100],
	[1720,   20, 100,  50],
	[1720,   80, 100,  50],
	[1770,  140, 100,  50],
	[1770,  200, 100,  50],
	[1720,  140,  40, 100],
	[1920,  240, 100,  70],
	[1920,  120,  40,  70],
	[1720,  320, 100,  50],
	[1720,  380, 100,  50],
	[1770,  440, 100,  50],
	[1770,  500, 100,  50],
	[1720,  440,  40,  70],
	[1920,  540, 100,  70],
	[1920,  420,  40,  70],
	[1020,  620, 100,  50],
	[1020,  680, 100,  50],
	[1070,  740, 100,  50],
	[1070,  800, 100,  50],
	[1020,  740,  40, 100],
	[1220,  840, 100, 100],
	[1220,  720,  40, 100],
	[1320,  720, 100,  50],
	[1320,  780, 100,  50],
	[1370,  840, 100,  50],
	[1370,  900, 100,  50],
	[1320,  840,  40, 100],
	[1520,  940, 100, 100],
	[1520,  820,  40, 100],
	[1630,  940,  40, 100],
	[1720,  720, 100,  50],
	[1720,  780, 100,  50],
	[1770,  840, 100,  50],
	[1770,  900, 100,  50],
	[1720,  840,  40, 100],
	[1920,  940, 100, 100],
	[1920,  820,  40, 100],
	[  20, 1020, 100,  50],
	[  20, 1080, 100,  50],
	[  70, 1140, 100,  50],
	[  70, 1200, 100,  50],
	[  20, 1140,  40, 100],
	[ 220, 1240, 100, 100],
	[ 220, 1120,  40, 100],
	[ 320, 1020, 100,  50],
	[ 320, 1080, 100,  50],
	[ 370, 1140, 100,  50],
	[ 370, 1200, 100,  50],
	[ 320, 1140,  40, 100],
	[ 520, 1240, 100, 100],
	[ 520, 1120,  40, 100],
	[ 630, 1240,  40, 100],
	[  20, 1320, 100,  50],
	[  20, 1380, 100,  50],
	[  70, 1440, 100,  50],
	[  70, 1500, 100,  50],
	[  20, 1440,  40, 100],
	[ 220, 1540, 100, 100],
	[ 220, 1420,  40, 100],
	[ 320, 1320, 100,  50],
	[ 320, 1380, 100,  50],
	[ 370, 1440, 100,  50],
	[ 370, 1500, 100,  50],
	[ 320, 1440,  40, 100],
	[ 520, 1540, 100, 100],
	[ 520, 1420,  40, 100],
	[ 630, 1540,  40, 100],
	[ 720, 1020, 100,  50],
	[ 720, 1080, 100,  50],
	[ 770, 1140, 100,  50],
	[ 770, 1200, 100,  50],
	[ 720, 1140,  40, 100],
	[ 920, 1240, 100, 100],
	[ 920, 1120,  40, 100],
	[ 720, 1320, 100,  50],
	[ 720, 1380, 100,  50],
	[ 770, 1440, 100,  50],
	[ 770, 1500, 100,  50],
	[ 720, 1440,  40, 100],
	[ 920, 1540, 100, 100],
	[ 920, 1420,  40, 100],
	[  20, 1620, 100,  50],
	[  20, 1680, 100,  50],
	[  70, 1740, 100,  50],
	[  70, 1800, 100,  50],
	[  20, 1740,  40, 100],
	[ 220, 1840, 100, 100],
	[ 220, 1720,  40, 100],
	[ 320, 1720, 100,  50],
	[ 320, 1780, 100,  50],
	[ 370, 1840, 100,  50],
	[ 370, 1900, 100,  50],
	[ 320, 1840,  40, 100],
	[ 520, 1940, 100, 100],
	[ 520, 1820,  40, 100],
	[ 630, 1940,  40, 100],
	[ 720, 1720, 100,  50],
	[ 720, 1780, 100,  50],
	[ 770, 1840, 100,  50],
	[ 770, 1900, 100,  50],
	[ 720, 1840,  40, 100],
	[ 920, 1940, 100, 100],
	[ 920, 1820,  40, 100],
	[1020, 1020, 100,  50],
	[1020, 1080, 100,  50],
	[1070, 1140, 100,  50],
	[1070, 1200, 100,  50],
	[1020, 1140,  40, 100],
	[1220, 1240, 100, 100],
	[1220, 1120,  40, 100],
	[1320, 1020, 100,  50],
	[1320, 1080, 100,  50],
	[1370, 1140, 100,  50],
	[1370, 1200, 100,  50],
	[1320, 1140,  40, 100],
	[1520, 1240, 100, 100],
	[1520, 1120,  40, 100],
	[1630, 1240,  40, 100],
	[1020, 1320, 100,  50],
	[1020, 1380, 100,  50],
	[1070, 1440, 100,  50],
	[1070, 1500, 100,  50],
	[1020, 1440,  40, 100],
	[1220, 1540, 100, 100],
	[1220, 1420,  40, 100],
	[1320, 1320, 100,  50],
	[1320, 1380, 100,  50],
	[1370, 1440, 100,  50],
	[1370, 1500, 100,  50],
	[1320, 1440,  40, 100],
	[1520, 1540, 100, 100],
	[1520, 1420,  40, 100],
	[1630, 1540,  40, 100],
	[1720, 1020, 100,  50],
	[1720, 1080, 100,  50],
	[1770, 1140, 100,  50],
	[1770, 1200, 100,  50],
	[1720, 1140,  40, 100],
	[1920, 1240, 100,  70],
	[1920, 1120,  40,  70],
	[1720, 1320, 100,  50],
	[1720, 1380, 100,  50],
	[1770, 1440, 100,  50],
	[1770, 1500, 100,  50],
	[1720, 1440,  40,  70],
	[1920, 1540, 100,  70],
	[1920, 1420,  40,  70],
	[1020, 1620, 100,  50],
	[1020, 1680, 100,  50],
	[1070, 1740, 100,  50],
	[1070, 1800, 100,  50],
	[1020, 1740,  40, 100],
	[1220, 1840, 100, 100],
	[1220, 1720,  40, 100],
	[1320, 1720, 100,  50],
	[1320, 1780, 100,  50],
	[1370, 1840, 100,  50],
	[1370, 1900, 100,  50],
	[1320, 1840,  40, 100],
	[1520, 1940, 100, 100],
	[1520, 1820,  40, 100],
	[1630, 1940,  40, 100],
	[1720, 1720, 100,  50],
	[1720, 1780, 100,  50],
	[1770, 1840, 100,  50],
	[1770, 1900, 100,  50],
	[1720, 1840,  40, 100],
	[1920, 1940, 100, 100],
	[1920, 1820,  40, 100],
	
	[2220,  240, 100, 100],
	[2220,  120,  40, 100],
	[2320,   20, 100,  50],
	[2320,   80, 100,  50],
	[2370,  140, 100,  50],
	[2370,  200, 100,  50],
	[2320,  140,  40, 100],
	[2520,  240, 100, 100],
	[2520,  120,  40, 100],
	[2630,  240,  40, 100],
	[2220,  540, 100, 100],
	[2220,  420,  40, 100],
	[2320,  320, 100,  50],
	[2320,  380, 100,  50],
	[2370,  440, 100,  50],
	[2370,  500, 100,  50],
	[2320,  440,  40, 100],
	[2520,  540, 100, 100],
	[2520,  420,  40, 100],
	[2630,  540,  40, 100],
	[2720,   20, 100,  50],
	[2720,   80, 100,  50],
	[2770,  140, 100,  50],
	[2770,  200, 100,  50],
	[2720,  140,  40, 100],
	[2920,  240, 100, 100],
	[2920,  120,  40, 100],
	[2720,  320, 100,  50],
	[2720,  380, 100,  50],
	[2770,  440, 100,  50],
	[2770,  500, 100,  50],
	[2720,  440,  40, 100],
	[2920,  540, 100, 100],
	[2920,  420,  40, 100],
	[2220,  840, 100, 100],
	[2220,  720,  40, 100],
	[2320,  720, 100,  50],
	[2320,  780, 100,  50],
	[2370,  840, 100,  50],
	[2370,  900, 100,  50],
	[2320,  840,  40, 100],
	[2520,  940, 100, 100],
	[2520,  820,  40, 100],
	[2630,  940,  40, 100],
	[2720,  720, 100,  50],
	[2720,  780, 100,  50],
	[2770,  840, 100,  50],
	[2770,  900, 100,  50],
	[2720,  840,  40, 100],
	[2920,  940, 100, 100],
	[2920,  820,  40, 100],
	[3020,   20, 100,  50],
	[3020,   80, 100,  50],
	[3070,  140, 100,  50],
	[3070,  200, 100,  50],
	[3020,  140,  40, 100],
	[3220,  240, 100, 100],
	[3220,  120,  40, 100],
	[3320,   20, 100,  50],
	[3320,   80, 100,  50],
	[3370,  140, 100,  50],
	[3370,  200, 100,  50],
	[3320,  140,  40, 100],
	[3520,  240, 100, 100],
	[3520,  120,  40, 100],
	[3630,  240,  40, 100],
	[3020,  320, 100,  50],
	[3020,  380, 100,  50],
	[3070,  440, 100,  50],
	[3070,  500, 100,  50],
	[3020,  440,  40, 100],
	[3220,  540, 100, 100],
	[3220,  420,  40, 100],
	[3320,  320, 100,  50],
	[3320,  380, 100,  50],
	[3370,  440, 100,  50],
	[3370,  500, 100,  50],
	[3320,  440,  40, 100],
	[3520,  540, 100, 100],
	[3520,  420,  40, 100],
	[3630,  540,  40, 100],
	[3720,   20, 100,  50],
	[3720,   80, 100,  50],
	[3770,  140, 100,  50],
	[3770,  200, 100,  50],
	[3720,  140,  40, 100],
	[3920,  240, 100,  70],
	[3920,  120,  40,  70],
	[3720,  320, 100,  50],
	[3720,  380, 100,  50],
	[3770,  440, 100,  50],
	[3770,  500, 100,  50],
	[3720,  440,  40,  70],
	[3920,  540, 100,  70],
	[3920,  420,  40,  70],
	[3020,  620, 100,  50],
	[3020,  680, 100,  50],
	[3070,  740, 100,  50],
	[3070,  800, 100,  50],
	[3020,  740,  40, 100],
	[3220,  840, 100, 100],
	[3220,  720,  40, 100],
	[3320,  720, 100,  50],
	[3320,  780, 100,  50],
	[3370,  840, 100,  50],
	[3370,  900, 100,  50],
	[3320,  840,  40, 100],
	[3520,  940, 100, 100],
	[3520,  820,  40, 100],
	[3630,  940,  40, 100],
	[3720,  720, 100,  50],
	[3720,  780, 100,  50],
	[3770,  840, 100,  50],
	[3770,  900, 100,  50],
	[3720,  840,  40, 100],
	[3920,  940, 100, 100],
	[3920,  820,  40, 100],
	[2220, 1240, 100, 100],
	[2220, 1120,  40, 100],
	[2320, 1020, 100,  50],
	[2320, 1080, 100,  50],
	[2370, 1140, 100,  50],
	[2370, 1200, 100,  50],
	[2320, 1140,  40, 100],
	[2520, 1240, 100, 100],
	[2520, 1120,  40, 100],
	[2630, 1240,  40, 100],
	[2220, 1540, 100, 100],
	[2220, 1420,  40, 100],
	[2320, 1320, 100,  50],
	[2320, 1380, 100,  50],
	[2370, 1440, 100,  50],
	[2370, 1500, 100,  50],
	[2320, 1440,  40, 100],
	[2520, 1540, 100, 100],
	[2520, 1420,  40, 100],
	[2630, 1540,  40, 100],
	[2720, 1020, 100,  50],
	[2720, 1080, 100,  50],
	[2770, 1140, 100,  50],
	[2770, 1200, 100,  50],
	[2720, 1140,  40, 100],
	[2920, 1240, 100, 100],
	[2920, 1120,  40, 100],
	[2720, 1320, 100,  50],
	[2720, 1380, 100,  50],
	[2770, 1440, 100,  50],
	[2770, 1500, 100,  50],
	[2720, 1440,  40, 100],
	[2920, 1540, 100, 100],
	[2920, 1420,  40, 100],
	[2220, 1840, 100, 100],
	[2220, 1720,  40, 100],
	[2320, 1720, 100,  50],
	[2320, 1780, 100,  50],
	[2370, 1840, 100,  50],
	[2370, 1900, 100,  50],
	[2320, 1840,  40, 100],
	[2520, 1940, 100, 100],
	[2520, 1820,  40, 100],
	[2630, 1940,  40, 100],
	[2720, 1720, 100,  50],
	[2720, 1780, 100,  50],
	[2770, 1840, 100,  50],
	[2770, 1900, 100,  50],
	[2720, 1840,  40, 100],
	[2920, 1940, 100, 100],
	[2920, 1820,  40, 100],
	[3020, 1020, 100,  50],
	[3020, 1080, 100,  50],
	[3070, 1140, 100,  50],
	[3070, 1200, 100,  50],
	[3020, 1140,  40, 100],
	[3220, 1240, 100, 100],
	[3220, 1120,  40, 100],
	[3320, 1020, 100,  50],
	[3320, 1080, 100,  50],
	[3370, 1140, 100,  50],
	[3370, 1200, 100,  50],
	[3320, 1140,  40, 100],
	[3520, 1240, 100, 100],
	[3520, 1120,  40, 100],
	[3630, 1240,  40, 100],
	[3020, 1320, 100,  50],
	[3020, 1380, 100,  50],
	[3070, 1440, 100,  50],
	[3070, 1500, 100,  50],
	[3020, 1440,  40, 100],
	[3220, 1540, 100, 100],
	[3220, 1420,  40, 100],
	[3320, 1320, 100,  50],
	[3320, 1380, 100,  50],
	[3370, 1440, 100,  50],
	[3370, 1500, 100,  50],
	[3320, 1440,  40, 100],
	[3520, 1540, 100, 100],
	[3520, 1420,  40, 100],
	[3630, 1540,  40, 100],
	[3720, 1020, 100,  50],
	[3720, 1080, 100,  50],
	[3770, 1140, 100,  50],
	[3770, 1200, 100,  50],
	[3720, 1140,  40, 100],
	[3920, 1240, 100,  70],
	[3920, 1120,  40,  70],
	[3720, 1320, 100,  50],
	[3720, 1380, 100,  50],
	[3770, 1440, 100,  50],
	[3770, 1500, 100,  50],
	[3720, 1440,  40,  70],
	[3920, 1540, 100,  70],
	[3920, 1420,  40,  70],
	[3020, 1620, 100,  50],
	[3020, 1680, 100,  50],
	[3070, 1740, 100,  50],
	[3070, 1800, 100,  50],
	[3020, 1740,  40, 100],
	[3220, 1840, 100, 100],
	[3220, 1720,  40, 100],
	[3320, 1720, 100,  50],
	[3320, 1780, 100,  50],
	[3370, 1840, 100,  50],
	[3370, 1900, 100,  50],
	[3320, 1840,  40, 100],
	[3520, 1940, 100, 100],
	[3520, 1820,  40, 100],
	[3630, 1940,  40, 100],
	[3720, 1720, 100,  50],
	[3720, 1780, 100,  50],
	[3770, 1840, 100,  50],
	[3770, 1900, 100,  50],
	[3720, 1840,  40, 100],
	[3920, 1940, 100, 100],
	[3920, 1820,  40, 100]
]));
		</script>
		<script src="/files/js/google-analytics.js"></script>
	</body>
</html>